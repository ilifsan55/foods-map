{"ast":null,"code":"var _jsxFileName = \"/Users/kokiyamamoto/Desktop/projects/FoodsMap/src/components/gmap.jsx\",\n    _s = $RefreshSig$();\n\nimport React, { useEffect } from 'react';\nimport { resultListSlice } from '../redux/resultListSlice';\nimport { appSlice } from '../redux/appSlice';\nimport { mapSlice } from '../redux/mapSlice';\nimport { useSelector, useDispatch } from 'react-redux';\nimport './gmap.css';\nimport axios from 'axios';\nimport { initService, doGoogleMapSearchPromise, createRequest, createMarker } from './mapapi';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nlet map, service;\nlet shouldMapInitialize = true;\nlet hasUserLocation,\n    isUserLocRequested = false;\nlet userLocation = {\n  lat: 35.41221,\n  lng: 139.4130\n};\nconst radius = 1000;\n\nfunction GMap(props) {\n  _s();\n\n  let dispatch = useDispatch();\n  const searchRequest = useSelector(state => state.app.searchRequest);\n  const selectorMapSlice = useSelector(state => state.mapSlice.isUserLocRequested);\n  const GmapMemo = /*#__PURE__*/React.memo(props => {\n    return /*#__PURE__*/_jsxDEV(\"h1\", {\n      children: [\"Hello \", props.name]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 30,\n      columnNumber: 16\n    }, this);\n  });\n\n  if (searchRequest.isDone == false) {\n    dispatch(appSlice.actions.setRequestDone());\n    let req = createRequest(searchRequest, props.userLoc);\n    doGoogleMapSearchPromise(req, service).then(response => {\n      let res = resultsParser(response); //places found! put them into parser to parse them for easier prossesing.\n\n      dispatch(resultListSlice.actions.setSearchResult(res));\n    }).catch(status => {\n      let res = resultsParser(0); //error in searching.\n\n      dispatch(resultListSlice.actions.setSearchResult(res));\n    });\n  }\n\n  useEffect(() => {\n    if (!hasUserLocation && isUserLocRequested) {\n      let prm = getUserLocation.then(function (value) {\n        userLocation = {\n          lat: value.coords.latitude,\n          lng: value.coords.longitude\n        };\n        hasUserLocation = true;\n      }).catch(value => {\n        hasUserLocation = false;\n      }).finally(() => {});\n    }\n\n    if (shouldMapInitialize) {\n      console.log(\"ss\");\n      initMap(document.getElementById('map'), props.userLoc, props.radius);\n      service = initService(map);\n      shouldMapInitialize = false;\n    }\n  });\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {},\n      id: \"map\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 87,\n      columnNumber: 13\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 86,\n    columnNumber: 9\n  }, this);\n}\n\n_s(GMap, \"0UkXc+i5mMglldSl0OWhe/0Uhs8=\", false, function () {\n  return [useDispatch, useSelector, useSelector];\n});\n\n_c = GMap;\n\nfunction initMap(element, userLoc, radius) {\n  console.log(\"Map Initialized\"); //create an actual gmap \n\n  map = new window.google.maps.Map(element, {\n    center: userLoc,\n    zoom: 15\n  }); //draw user and user radius\n\n  let circle = new window.google.maps.Circle({\n    center: userLoc,\n    fillColor: '#ff0000',\n    fillOpacity: 0.2,\n    map: map,\n    radius: radius * 2,\n    strokeColor: '#ff0000',\n    strokeOpacity: 1,\n    strokeWeight: 1\n  });\n  let userpos = new window.google.maps.Circle({\n    center: userLoc,\n    fillColor: '#0000ff',\n    fillOpacity: 0.45,\n    map: map,\n    radius: 20,\n    strokeColor: '#0000ff',\n    strokeOpacity: 1,\n    strokeWeight: 1\n  });\n}\n\nconst resultsParser = results => {\n  let parsedResults = [];\n\n  if (results == 0 || results.length <= 0) {\n    let result_temp = {};\n    result_temp.name = '何も見つかりませんでした。';\n    result_temp.vicinity = '';\n    result_temp.rating = '';\n    parsedResults.push(result_temp);\n    return parsedResults;\n  }\n\n  for (let i = 0; i < results.length; i++) {\n    let result_temp = {};\n    let result = results[i];\n    createMarker(result, i + 1, map);\n    result_temp.name = result.name;\n    result_temp.vicinity = result.vicinity;\n    result_temp.rating = result.rating;\n    result_temp.lat = result.geometry.location.lat();\n    result_temp.lng = result.geometry.location.lng();\n    parsedResults.push(result_temp);\n  }\n\n  return parsedResults;\n};\n\nconst getUserLocation = new Promise((resolve, reject) => {\n  navigator.geolocation.getCurrentPosition(resolve, reject);\n});\nexport default GMap;\n\nvar _c;\n\n$RefreshReg$(_c, \"GMap\");","map":{"version":3,"names":["React","useEffect","resultListSlice","appSlice","mapSlice","useSelector","useDispatch","axios","initService","doGoogleMapSearchPromise","createRequest","createMarker","map","service","shouldMapInitialize","hasUserLocation","isUserLocRequested","userLocation","lat","lng","radius","GMap","props","dispatch","searchRequest","state","app","selectorMapSlice","GmapMemo","memo","name","isDone","actions","setRequestDone","req","userLoc","then","response","res","resultsParser","setSearchResult","catch","status","prm","getUserLocation","value","coords","latitude","longitude","finally","console","log","initMap","document","getElementById","element","window","google","maps","Map","center","zoom","circle","Circle","fillColor","fillOpacity","strokeColor","strokeOpacity","strokeWeight","userpos","results","parsedResults","length","result_temp","vicinity","rating","push","i","result","geometry","location","Promise","resolve","reject","navigator","geolocation","getCurrentPosition"],"sources":["/Users/kokiyamamoto/Desktop/projects/FoodsMap/src/components/gmap.jsx"],"sourcesContent":["import React, { useEffect } from 'react';\nimport { resultListSlice } from '../redux/resultListSlice';\nimport { appSlice } from '../redux/appSlice';\nimport { mapSlice} from '../redux/mapSlice';\nimport { useSelector, useDispatch } from 'react-redux';\nimport './gmap.css';\nimport axios from 'axios';\nimport { initService, doGoogleMapSearchPromise, createRequest, createMarker } from './mapapi'\n\n\nlet map, service;\nlet shouldMapInitialize = true;\nlet hasUserLocation, isUserLocRequested = false;\nlet userLocation = {\n    lat: 35.41221,\n    lng: 139.4130\n};\nconst radius = 1000;\n\n\n\nfunction GMap(props) {\n\n    let dispatch = useDispatch();\n\n    const searchRequest = useSelector(state => state.app.searchRequest);\n    const selectorMapSlice = useSelector(state => state.mapSlice.isUserLocRequested);\n\n    const GmapMemo = React.memo(props => {\n        return <h1>Hello {props.name}</h1>;\n    });\n\n    if (searchRequest.isDone == false) {\n\n        dispatch(appSlice.actions.setRequestDone());\n        let req = createRequest(searchRequest, props.userLoc);\n\n        doGoogleMapSearchPromise(req, service).then((response) => {\n\n            let res = resultsParser(response);//places found! put them into parser to parse them for easier prossesing.\n            dispatch(resultListSlice.actions.setSearchResult(res));\n\n        }).catch((status) => {\n\n            let res = resultsParser(0); //error in searching.\n            dispatch(resultListSlice.actions.setSearchResult(res));\n\n        });\n\n    }\n\n    useEffect(() => {\n\n        if (!hasUserLocation && isUserLocRequested) {\n            let prm = getUserLocation.then(function (value) {\n\n                userLocation = {\n                    lat: value.coords.latitude,\n                    lng: value.coords.longitude\n                };\n                hasUserLocation = true;\n\n            }).catch(value => {\n\n                hasUserLocation = false;\n\n            }).finally(() => {\n\n                \n\n            });\n            \n        }\n\n        if (shouldMapInitialize) {\n            console.log(\"ss\");\n            initMap(document.getElementById('map'), props.userLoc, props.radius);\n            service = initService(map);\n            shouldMapInitialize = false;\n        }\n    })\n\n\n\n    return (\n        <div>\n            <div style={{}} id='map'></div>\n        </div>\n    )\n}\n\nfunction initMap(element, userLoc, radius) {\n    console.log(\"Map Initialized\");\n    //create an actual gmap \n    map = new window.google.maps.Map(element, {\n        center: userLoc,\n        zoom: 15\n    });\n    //draw user and user radius\n    let circle = new window.google.maps.Circle({\n        center: userLoc,\n        fillColor: '#ff0000',\n        fillOpacity: 0.2,\n        map: map,\n        radius: radius * 2,\n        strokeColor: '#ff0000',\n        strokeOpacity: 1,\n        strokeWeight: 1\n    });\n    let userpos = new window.google.maps.Circle({\n        center: userLoc,\n        fillColor: '#0000ff',\n        fillOpacity: 0.45,\n        map: map,\n        radius: 20,\n        strokeColor: '#0000ff',\n        strokeOpacity: 1,\n        strokeWeight: 1\n    });\n\n}\nconst resultsParser = (results) => {\n\n    let parsedResults = [];\n    if (results == 0 || results.length <= 0) {\n\n        let result_temp = {};\n        result_temp.name = '何も見つかりませんでした。';\n        result_temp.vicinity = '';\n        result_temp.rating = '';\n        parsedResults.push(result_temp);\n        return parsedResults;\n\n    }\n    for (let i = 0; i < results.length; i++) {\n\n        let result_temp = {};\n        let result = results[i];\n        createMarker(result, i + 1, map);\n\n        result_temp.name = result.name;\n        result_temp.vicinity = result.vicinity;\n        result_temp.rating = result.rating;\n        result_temp.lat = result.geometry.location.lat();\n        result_temp.lng = result.geometry.location.lng();\n        parsedResults.push(result_temp);\n    }\n\n    return parsedResults;\n\n}\n\n\nconst getUserLocation = new Promise((resolve, reject) => {\n    navigator.geolocation.getCurrentPosition(resolve, reject)\n})\n\n\nexport default GMap;\n"],"mappings":";;;AAAA,OAAOA,KAAP,IAAgBC,SAAhB,QAAiC,OAAjC;AACA,SAASC,eAAT,QAAgC,0BAAhC;AACA,SAASC,QAAT,QAAyB,mBAAzB;AACA,SAASC,QAAT,QAAwB,mBAAxB;AACA,SAASC,WAAT,EAAsBC,WAAtB,QAAyC,aAAzC;AACA,OAAO,YAAP;AACA,OAAOC,KAAP,MAAkB,OAAlB;AACA,SAASC,WAAT,EAAsBC,wBAAtB,EAAgDC,aAAhD,EAA+DC,YAA/D,QAAmF,UAAnF;;AAGA,IAAIC,GAAJ,EAASC,OAAT;AACA,IAAIC,mBAAmB,GAAG,IAA1B;AACA,IAAIC,eAAJ;AAAA,IAAqBC,kBAAkB,GAAG,KAA1C;AACA,IAAIC,YAAY,GAAG;EACfC,GAAG,EAAE,QADU;EAEfC,GAAG,EAAE;AAFU,CAAnB;AAIA,MAAMC,MAAM,GAAG,IAAf;;AAIA,SAASC,IAAT,CAAcC,KAAd,EAAqB;EAAA;;EAEjB,IAAIC,QAAQ,GAAGjB,WAAW,EAA1B;EAEA,MAAMkB,aAAa,GAAGnB,WAAW,CAACoB,KAAK,IAAIA,KAAK,CAACC,GAAN,CAAUF,aAApB,CAAjC;EACA,MAAMG,gBAAgB,GAAGtB,WAAW,CAACoB,KAAK,IAAIA,KAAK,CAACrB,QAAN,CAAeY,kBAAzB,CAApC;EAEA,MAAMY,QAAQ,gBAAG5B,KAAK,CAAC6B,IAAN,CAAWP,KAAK,IAAI;IACjC,oBAAO;MAAA,qBAAWA,KAAK,CAACQ,IAAjB;IAAA;MAAA;MAAA;MAAA;IAAA,QAAP;EACH,CAFgB,CAAjB;;EAIA,IAAIN,aAAa,CAACO,MAAd,IAAwB,KAA5B,EAAmC;IAE/BR,QAAQ,CAACpB,QAAQ,CAAC6B,OAAT,CAAiBC,cAAjB,EAAD,CAAR;IACA,IAAIC,GAAG,GAAGxB,aAAa,CAACc,aAAD,EAAgBF,KAAK,CAACa,OAAtB,CAAvB;IAEA1B,wBAAwB,CAACyB,GAAD,EAAMrB,OAAN,CAAxB,CAAuCuB,IAAvC,CAA6CC,QAAD,IAAc;MAEtD,IAAIC,GAAG,GAAGC,aAAa,CAACF,QAAD,CAAvB,CAFsD,CAEpB;;MAClCd,QAAQ,CAACrB,eAAe,CAAC8B,OAAhB,CAAwBQ,eAAxB,CAAwCF,GAAxC,CAAD,CAAR;IAEH,CALD,EAKGG,KALH,CAKUC,MAAD,IAAY;MAEjB,IAAIJ,GAAG,GAAGC,aAAa,CAAC,CAAD,CAAvB,CAFiB,CAEW;;MAC5BhB,QAAQ,CAACrB,eAAe,CAAC8B,OAAhB,CAAwBQ,eAAxB,CAAwCF,GAAxC,CAAD,CAAR;IAEH,CAVD;EAYH;;EAEDrC,SAAS,CAAC,MAAM;IAEZ,IAAI,CAACc,eAAD,IAAoBC,kBAAxB,EAA4C;MACxC,IAAI2B,GAAG,GAAGC,eAAe,CAACR,IAAhB,CAAqB,UAAUS,KAAV,EAAiB;QAE5C5B,YAAY,GAAG;UACXC,GAAG,EAAE2B,KAAK,CAACC,MAAN,CAAaC,QADP;UAEX5B,GAAG,EAAE0B,KAAK,CAACC,MAAN,CAAaE;QAFP,CAAf;QAIAjC,eAAe,GAAG,IAAlB;MAEH,CARS,EAQP0B,KARO,CAQDI,KAAK,IAAI;QAEd9B,eAAe,GAAG,KAAlB;MAEH,CAZS,EAYPkC,OAZO,CAYC,MAAM,CAIhB,CAhBS,CAAV;IAkBH;;IAED,IAAInC,mBAAJ,EAAyB;MACrBoC,OAAO,CAACC,GAAR,CAAY,IAAZ;MACAC,OAAO,CAACC,QAAQ,CAACC,cAAT,CAAwB,KAAxB,CAAD,EAAiChC,KAAK,CAACa,OAAvC,EAAgDb,KAAK,CAACF,MAAtD,CAAP;MACAP,OAAO,GAAGL,WAAW,CAACI,GAAD,CAArB;MACAE,mBAAmB,GAAG,KAAtB;IACH;EACJ,CA7BQ,CAAT;EAiCA,oBACI;IAAA,uBACI;MAAK,KAAK,EAAE,EAAZ;MAAgB,EAAE,EAAC;IAAnB;MAAA;MAAA;MAAA;IAAA;EADJ;IAAA;IAAA;IAAA;EAAA,QADJ;AAKH;;GApEQO,I;UAEUf,W,EAEOD,W,EACGA,W;;;KALpBgB,I;;AAsET,SAAS+B,OAAT,CAAiBG,OAAjB,EAA0BpB,OAA1B,EAAmCf,MAAnC,EAA2C;EACvC8B,OAAO,CAACC,GAAR,CAAY,iBAAZ,EADuC,CAEvC;;EACAvC,GAAG,GAAG,IAAI4C,MAAM,CAACC,MAAP,CAAcC,IAAd,CAAmBC,GAAvB,CAA2BJ,OAA3B,EAAoC;IACtCK,MAAM,EAAEzB,OAD8B;IAEtC0B,IAAI,EAAE;EAFgC,CAApC,CAAN,CAHuC,CAOvC;;EACA,IAAIC,MAAM,GAAG,IAAIN,MAAM,CAACC,MAAP,CAAcC,IAAd,CAAmBK,MAAvB,CAA8B;IACvCH,MAAM,EAAEzB,OAD+B;IAEvC6B,SAAS,EAAE,SAF4B;IAGvCC,WAAW,EAAE,GAH0B;IAIvCrD,GAAG,EAAEA,GAJkC;IAKvCQ,MAAM,EAAEA,MAAM,GAAG,CALsB;IAMvC8C,WAAW,EAAE,SAN0B;IAOvCC,aAAa,EAAE,CAPwB;IAQvCC,YAAY,EAAE;EARyB,CAA9B,CAAb;EAUA,IAAIC,OAAO,GAAG,IAAIb,MAAM,CAACC,MAAP,CAAcC,IAAd,CAAmBK,MAAvB,CAA8B;IACxCH,MAAM,EAAEzB,OADgC;IAExC6B,SAAS,EAAE,SAF6B;IAGxCC,WAAW,EAAE,IAH2B;IAIxCrD,GAAG,EAAEA,GAJmC;IAKxCQ,MAAM,EAAE,EALgC;IAMxC8C,WAAW,EAAE,SAN2B;IAOxCC,aAAa,EAAE,CAPyB;IAQxCC,YAAY,EAAE;EAR0B,CAA9B,CAAd;AAWH;;AACD,MAAM7B,aAAa,GAAI+B,OAAD,IAAa;EAE/B,IAAIC,aAAa,GAAG,EAApB;;EACA,IAAID,OAAO,IAAI,CAAX,IAAgBA,OAAO,CAACE,MAAR,IAAkB,CAAtC,EAAyC;IAErC,IAAIC,WAAW,GAAG,EAAlB;IACAA,WAAW,CAAC3C,IAAZ,GAAmB,eAAnB;IACA2C,WAAW,CAACC,QAAZ,GAAuB,EAAvB;IACAD,WAAW,CAACE,MAAZ,GAAqB,EAArB;IACAJ,aAAa,CAACK,IAAd,CAAmBH,WAAnB;IACA,OAAOF,aAAP;EAEH;;EACD,KAAK,IAAIM,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGP,OAAO,CAACE,MAA5B,EAAoCK,CAAC,EAArC,EAAyC;IAErC,IAAIJ,WAAW,GAAG,EAAlB;IACA,IAAIK,MAAM,GAAGR,OAAO,CAACO,CAAD,CAApB;IACAlE,YAAY,CAACmE,MAAD,EAASD,CAAC,GAAG,CAAb,EAAgBjE,GAAhB,CAAZ;IAEA6D,WAAW,CAAC3C,IAAZ,GAAmBgD,MAAM,CAAChD,IAA1B;IACA2C,WAAW,CAACC,QAAZ,GAAuBI,MAAM,CAACJ,QAA9B;IACAD,WAAW,CAACE,MAAZ,GAAqBG,MAAM,CAACH,MAA5B;IACAF,WAAW,CAACvD,GAAZ,GAAkB4D,MAAM,CAACC,QAAP,CAAgBC,QAAhB,CAAyB9D,GAAzB,EAAlB;IACAuD,WAAW,CAACtD,GAAZ,GAAkB2D,MAAM,CAACC,QAAP,CAAgBC,QAAhB,CAAyB7D,GAAzB,EAAlB;IACAoD,aAAa,CAACK,IAAd,CAAmBH,WAAnB;EACH;;EAED,OAAOF,aAAP;AAEH,CA7BD;;AAgCA,MAAM3B,eAAe,GAAG,IAAIqC,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;EACrDC,SAAS,CAACC,WAAV,CAAsBC,kBAAtB,CAAyCJ,OAAzC,EAAkDC,MAAlD;AACH,CAFuB,CAAxB;AAKA,eAAe9D,IAAf"},"metadata":{},"sourceType":"module"}